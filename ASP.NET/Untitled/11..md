## 11. Autenticação e Autorização

### 11.1 Identity Framework

**Teoria:**  
ASP.NET Core Identity é um framework completo para autenticação e gerenciamento de usuários:

- Oferece funcionalidades de registro, login e gerenciamento de contas
- Armazena informações de usuários de forma segura
- Suporta confirmação de email, recuperação de senha, autenticação de dois fatores
- Integra-se facilmente com Entity Framework Core
- Extensível para requisitos personalizados

### 11.2 Políticas de Autorização

**Teoria:**  
Políticas de autorização determinam o que usuários autenticados podem fazer:

- Baseadas em roles (papéis): administrador, usuário, etc.
- Baseadas em claims (afirmações): idade, departamento, etc.
- Baseadas em requisitos: podem combinar múltiplas condições
- Aplicadas via atributos ou programaticamente

### 11.3 Prática: Implementando Autenticação

**Prática:**

1. **Instalar os pacotes necessários:**
    
    bashresponse-action-icon
    
    ```bash
    dotnet add package Microsoft.AspNetCore.Identity.EntityFrameworkCore
    dotnet add package Microsoft.AspNetCore.Identity.UI
    ```
    
2. **Configurar o Identity no contexto:**
    
    csharpresponse-action-icon
    
    ```csharp
    // Data/AppDbContext.cs
    using Microsoft.AspNetCore.Identity.EntityFrameworkCore;
    using Microsoft.EntityFrameworkCore;
    using MeuProjeto.Models;
    
    namespace MeuProjeto.Data
    {
        public class AppDbContext : IdentityDbContext
        {
            public AppDbContext(DbContextOptions<AppDbContext> options)
                : base(options)
            {
            }
            
            public DbSet<Category> Categories { get; set; }
            public DbSet<Product> Products { get; set; }
            
            // Outros DbSets...
        }
    }
    ```
    
3. **Configurar Identity nos serviços:**
    
    csharpresponse-action-icon
    
    ```csharp
    // Program.cs (ASP.NET Core 6+)
    
    // Adicionar Identity
    builder.Services.AddDefaultIdentity<IdentityUser>(options => {
        options.SignIn.RequireConfirmedAccount = true;
        options.Password.RequireDigit = true;
        options.Password.RequireLowercase = true;
        options.Password.RequireUppercase = true;
        options.Password.RequireNonAlphanumeric = true;
        options.Password.RequiredLength = 8;
    })
    ```