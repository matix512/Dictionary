## 5.1 Definição de Models

Os models no ASP.NET Core MVC representam os dados e a lógica de negócios da aplicação. Em uma fábrica de calçados, os models vão representar entidades como modelos de calçados, ordens de produção, materiais, funcionários, entre outros.

==Exemplo de model básico para um modelo de calçado:==
```csharp
namespace CalcadosOmega.Models
{
    public class ModeloCalcado
    {
        public int Id { get; set; }
        public string Codigo { get; set; }
        public string Nome { get; set; }
        public string Descricao { get; set; }
        public decimal PrecoBase { get; set; }
        public string Categoria { get; set; }
        public string Genero { get; set; }
        public bool Ativo { get; set; }
        public DateTime DataCriacao { get; set; }
        public string ImagemUrl { get; set; }
        public ICollection<TamanhoDisponivel> TamanhosDisponiveis { get; set; }
        public ICollection<CorDisponivel> CoresDisponiveis { get; set; }
        public ICollection<MaterialUtilizado> Materiais { get; set; }
    }

	public class TamanhoDisponivel
	{
	    public int Id { get; set; }
	    public int ModeloCalcadoId { get; set; }
	    public ModeloCalcado ModeloCalcado { get; set; }
	    public int Tamanho { get; set; }
	    public bool TemEstoque { get; set; }
	}

	public class CorDisponivel
	{
	    public int Id { get; set; }
	    public int ModeloCalcadoId { get; set; }
	    public ModeloCalcado ModeloCalcado { get; set; }
	    public string Nome { get; set; }
	    public string CodigoHexadecimal { get; set; }
	}

	public class MaterialUtilizado
	{
	    public int Id { get; set; }
	    public int ModeloCalcadoId { get; set; }
	    public ModeloCalcado ModeloCalcado { get; set; }
	    public int MaterialId { get; set; }
	    public Material Material { get; set; }
	    public string Parte { get; set; } // Ex: Solado, Cabedal, Forro
	    public decimal Quantidade { get; set; }
	    public string UnidadeMedida { get; set; }
	}

	public class Material
	{
	    public int Id { get; set; }
	    public string Codigo { get; set; }
	    public string Nome { get; set; }
	    public string Descricao { get; set; }
	    public string UnidadeMedida { get; set; }
	    public decimal PrecoUnitario { get; set; }
	    public int EstoqueMinimo { get; set; }
	    public int EstoqueAtual { get; set; }
	    public ICollection<MaterialUtilizado> UtilizadoEm { get; set; }
	    public ICollection<FornecedorMaterial> Fornecedores { get; set; }
}
```


Exemplo de model para turnos de produção:

```csharp
public class TurnoProducao
{
    public int Id { get; set; }
    public DateTime DataInicio { get; set; }
    public DateTime? DataFim { get; set; }
    public string Supervisor { get; set; }
    public string TipoTurno { get; set; } // Manhã, Tarde, Noite
    public string Status { get; set; } // Em Andamento, Concluído, Cancelado
    public ICollection<ItemProducao> ItensProduzidos { get; set; }
    public ICollection<ParadaProducao> Paradas { get; set; }
    public string Observacoes { get; set; }
}

public class ItemProducao
{
    public int Id { get; set; }
    public int TurnoProducaoId { get; set; }
    public TurnoProducao TurnoProducao { get; set; }
    public int ModeloCalcadoId { get; set; }
    public ModeloCalcado ModeloCalcado { get; set; }
    public int Tamanho { get; set; }
    public string Cor { get; set; }
    public int QuantidadePlanejada { get; set; }
    public int QuantidadeProduzida { get; set; }
    public int QuantidadeDefeituosa { get; set; }
    public DateTime HoraRegistro { get; set; }
}

public class ParadaProducao
{
    public int Id { get; set; }
    public int TurnoProducaoId { get; set; }
    public TurnoProducao TurnoProducao { get; set; }
    public DateTime HoraInicio { get; set; }
    public DateTime? HoraFim { get; set; }
    public string Motivo { get; set; }
    public string Descricao { get; set; }
    public string ResponsavelSolucao { get; set; }
    public string AcaoCorretiva { get; set; }
    public bool AcaoPreventiva { get; set; }
}
```

## 5.2 Data Annotations

As Data Annotations são atributos que podem ser aplicados às propriedades dos models para adicionar regras de validação e definir metadados para a exibição:

```csharp
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace CalcadosOmega.Models
{
    public class ModeloCalcado
    {
        public int Id { get; set; }
        
        [Required(ErrorMessage = "O código do modelo é obrigatório")]
        [StringLength(10, MinimumLength = 4, ErrorMessage = "O código deve ter entre 4 e 10 caracteres")]
        [Display(Name = "Código do Modelo")]
        public string Codigo { get; set; }
        
        [Required(ErrorMessage = "O nome do modelo é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome não pode exceder 100 caracteres")]
        [Display(Name = "Nome do Modelo")]
        public string Nome { get; set; }
        
        [DataType(DataType.MultilineText)]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        [Required(ErrorMessage = "O preço base é obrigatório")]
        [Range(0.01, 9999.99, ErrorMessage = "O preço deve estar entre R$ 0,01 e R$ 9.999,99")]
        [DataType(DataType.Currency)]
        [Column(TypeName = "decimal(10, 2)")]
        [Display(Name = "Preço Base")]
        public decimal PrecoBase { get; set; }
        
        [Required(ErrorMessage = "A categoria é obrigatória")]
        public string Categoria { get; set; }
        
        [Required(ErrorMessage = "O gênero é obrigatório")]
        public string Genero { get; set; }
        
        [Display(Name = "Modelo Ativo")]
        public bool Ativo { get; set; }
        
        [DataType(DataType.Date)]
        [Display(Name = "Data de Criação")]
        public DateTime DataCriacao { get; set; }
        
        [Url(ErrorMessage = "A URL da imagem deve ser válida")]
        [Display(Name = "URL da Imagem")]
        public string ImagemUrl { get; set; }
        
        // Validação personalizada para verificar código único
        public class CodigoUnicoAttribute : ValidationAttribute
        {
            protected override ValidationResult IsValid(object value, ValidationContext validationContext)
            {
                var model = (ModeloCalcado)validationContext.ObjectInstance;
                var dbContext = (ApplicationDbContext)validationContext
                    .GetService(typeof(ApplicationDbContext));
                
                var existeCodigo = dbContext.ModelosCalcado
                    .Any(m => m.Codigo == model.Codigo && m.Id != model.Id);
                
                if (existeCodigo)
                {
                    return new ValidationResult("Este código já está em uso.");
                }
                
                return ValidationResult.Success;
            }
        }
    }
    
    public class TurnoProducao
    {
        public int Id { get; set; }
        
        [Required(ErrorMessage = "A data de início é obrigatória")]
        [DataType(DataType.DateTime)]
        [Display(Name = "Data de Início")]
        public DateTime DataInicio { get; set; }
        
        [DataType(DataType.DateTime)]
        [Display(Name = "Data de Encerramento")]
        public DateTime? DataFim { get; set; }
        
        [Required(ErrorMessage = "O supervisor é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome do supervisor não pode exceder 100 caracteres")]
        public string Supervisor { get; set; }
        
        [Required(ErrorMessage = "O tipo de turno é obrigatório")]
        [Display(Name = "Tipo de Turno")]
        public string TipoTurno { get; set; }
        
        [Required(ErrorMessage = "O status é obrigatório")]
        public string Status { get; set; }
        
        [DataType(DataType.MultilineText)]
        [StringLength(500, ErrorMessage = "As observações não podem exceder 500 caracteres")]
        [Display(Name = "Observações")]
        public string Observacoes { get; set; }
        
        // Validação personalizada para verificar se a data de fim é posterior à data de início
        public class DataFimValidaAttribute : ValidationAttribute
        {
            protected override ValidationResult IsValid(object value, ValidationContext validationContext)
            {
                var turno = (TurnoProducao)validationContext.ObjectInstance;
                
                if (turno.DataFim.HasValue && turno.DataFim < turno.DataInicio)
                {
                    return new ValidationResult("A data de encerramento deve ser posterior à data de início.");
                }
                
                return ValidationResult.Success;
            }
        }
    }
}
```

## 5.3 ViewModels

Os ViewModels são classes específicas para as views que combinam dados de diferentes modelos ou apresentam apenas um subconjunto de propriedades de um modelo. Eles são úteis para adaptar os dados às necessidades específicas de uma view.

```csharp
namespace CalcadosOmega.ViewModels
{
    public class CatalogoModelosViewModel
    {
        public List<ModeloCalcado> ModelosAtivos { get; set; }
        public List<string> CategoriasDisponiveis { get; set; }
        public List<string> GenerosDisponiveis { get; set; }
        public string CategoriaAtual { get; set; }
        public string GeneroAtual { get; set; }
        public int TotalModelos { get; set; }
        public int Pagina { get; set; }
        public int TamanhoPagina { get; set; }
        public bool TemProximaPagina { get; set; }
    }
    
    public class DetalhesModeloViewModel
    {
        public ModeloCalcado Modelo { get; set; }
        public List<TamanhoDisponivel> TamanhosEmEstoque { get; set; }
        public List<CorDisponivel> CoresDisponiveis { get; set; }
        public Dictionary<string, decimal> QuantidadesMateriais { get; set; }
        public decimal CustoTotal { get; set; }
        public decimal MargemLucro { get; set; }
        public int QuantidadeProduzidaTotal { get; set; }
        public int QuantidadeProduzidaMes { get; set; }
    }
    
    public class DashboardProducaoViewModel
    {
        public TurnoProducao TurnoAtual { get; set; }
        public List<ItemProducao> UltimosItensProduzidos { get; set; }
        public Dictionary<string, int> ProducaoPorModelo { get; set; }
        public Dictionary<string, int> ProducaoPorCategoria { get; set; }
        public int TotalProduzidoHoje { get; set; }
        public int TotalProduzidoSemana { get; set; }
        public int TotalProduzidoMes { get; set; }
        public decimal EficienciaAtual { get; set; }
        public List<ParadaProducao> ParadasRecentes { get; set; }
        public int TempoTotalParadas { get; set; }
        public Dictionary<string, int> MotivoParadas { get; set; }
    }
    
    public class RelatorioProducaoViewModel
    {
        public DateTime DataInicio { get; set; }
        public DateTime DataFim { get; set; }
        public List<TurnoProducao> Turnos { get; set; }
        public int TotalProduzido { get; set; }
        public int TotalDefeituoso { get; set; }
        public decimal TaxaDefeito { get; set; }
        public decimal EficienciaMedia { get; set; }
        public Dictionary<string, int> ProducaoPorModelo { get; set; }
        public Dictionary<string, int> ProducaoPorSupervisor { get; set; }
        public Dictionary<string, int> ProducaoPorTurno { get; set; }
        public Dictionary<string, TimeSpan> TempoParadaPorMotivo { get; set; }
    }
    
    public class GerenciamentoEstoqueViewModel
    {
        public List<Material> MateriaisEmBaixoEstoque { get; set; }
        public Dictionary<int, int> ConsumoMensalPorMaterial { get; set; }
        public Dictionary<int, DateTime> UltimaCompraData { get; set; }
        public Dictionary<int, List<Fornecedor>> FornecedoresPorMaterial { get; set; }
        public List<OrdemCompra> OrdensCompraEmAberto { get; set; }
    }
}
```

## 5.4 Prática: Implementando Models para Gestão de Calçados

Vamos implementar uma estrutura de models completa para a fábrica de calçados, considerando diferentes aspectos do negócio:

### Models de Domínio

**Models/Producao/ModeloCalcado.cs**

```csharp
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace CalcadosOmega.Models.Producao
{
    public class ModeloCalcado
    {
        public ModeloCalcado()
        {
            TamanhosDisponiveis = new HashSet<TamanhoDisponivel>();
            CoresDisponiveis = new HashSet<CorDisponivel>();
            Materiais = new HashSet<MaterialUtilizado>();
            ItensProducao = new HashSet<ItemProducao>();
            DataCriacao = DateTime.Now;
            Ativo = true;
        }

        public int Id { get; set; }
        
        [Required(ErrorMessage = "O código do modelo é obrigatório")]
        [StringLength(15, MinimumLength = 4, ErrorMessage = "O código deve ter entre 4 e 15 caracteres")]
        [RegularExpression(@"^[A-Z0-9\-]+$", ErrorMessage = "O código deve conter apenas letras maiúsculas, números e hífens")]
        [Display(Name = "Código")]
        public string Codigo { get; set; }
        
        [Required(ErrorMessage = "O nome do modelo é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome não pode exceder 100 caracteres")]
        public string Nome { get; set; }
        
        [DataType(DataType.MultilineText)]
        [StringLength(500, ErrorMessage = "A descrição não pode exceder 500 caracteres")]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        [Required(ErrorMessage = "A categoria é obrigatória")]
        public int CategoriaId { get; set; }
        
        [ForeignKey("CategoriaId")]
        public virtual CategoriaCalcado Categoria { get; set; }
        
        [Required(ErrorMessage = "O gênero é obrigatório")]
        public string Genero { get; set; }
        
        [Required(ErrorMessage = "O preço base é obrigatório")]
        [Range(0.01, 9999.99, ErrorMessage = "O preço deve estar entre R$ 0,01 e R$ 9.999,99")]
        [DataType(DataType.Currency)]
        [Column(TypeName = "decimal(10, 2)")]
        [Display(Name = "Preço Base")]
        public decimal PrecoBase { get; set; }
        
        [Display(Name = "Tempo de Produção (min)")]
        [Range(1, 1000, ErrorMessage = "O tempo de produção deve estar entre 1 e 1000 minutos")]
        public int TempoProducaoMinutos { get; set; }
        
        [Display(Name = "Modelo Ativo")]
        public bool Ativo { get; set; }
        
        [DataType(DataType.Date)]
        [Display(Name = "Data de Criação")]
        public DateTime DataCriacao { get; set; }
        
        [Url(ErrorMessage = "A URL da imagem deve ser válida")]
        [Display(Name = "URL da Imagem")]
        public string ImagemUrl { get; set; }
        
        [StringLength(1000, ErrorMessage = "As instruções de fabricação não podem exceder 1000 caracteres")]
        [DataType(DataType.MultilineText)]
        [Display(Name = "Instruções de Fabricação")]
        public string InstrucoesFabricacao { get; set; }
        
        [Display(Name = "Referência do Designer")]
        public string ReferenciaDesigner { get; set; }
        
        public virtual ICollection<TamanhoDisponivel> TamanhosDisponiveis { get; set; }
        public virtual ICollection<CorDisponivel> CoresDisponiveis { get; set; }
        public virtual ICollection<MaterialUtilizado> Materiais { get; set; }
        public virtual ICollection<ItemProducao> ItensProducao { get; set; }
        
        [NotMapped]
        public decimal CustoTotal 
        { 
            get 
            {
                decimal custo = 0;
                foreach (var material in Materiais)
                {
                    custo += material.CustoTotal;
                }
                return custo;
            } 
        }
        
        [NotMapped]
        public decimal MargemLucro 
        { 
            get 
            {
                if (CustoTotal > 0)
                {
                    return (PrecoBase - CustoTotal) / CustoTotal * 100;
                }
                return 0;
            } 
        }
        
        public string ObterCodigoCompleto()
        {
            return $"{Categoria?.Sigla ?? "XX"}-{Codigo}-{Genero.Substring(0, 1)}";
        }
    }

    public class CategoriaCalcado
    {
        public CategoriaCalcado()
        {
            Modelos = new HashSet<ModeloCalcado>();
        }

        public int Id { get; set; }
        
        [Required(ErrorMessage = "O nome da categoria é obrigatório")]
        [StringLength(50, ErrorMessage = "O nome não pode exceder 50 caracteres")]
        public string Nome { get; set; }
        
        [Required(ErrorMessage = "A sigla da categoria é obrigatória")]
        [StringLength(3, MinimumLength = 2, ErrorMessage = "A sigla deve ter 2 ou 3 caracteres")]
        public string Sigla { get; set; }
        
        [DataType(DataType.MultilineText)]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        public virtual ICollection<ModeloCalcado> Modelos { get; set; }
    }

    public class TamanhoDisponivel
    {
        public int Id { get; set; }
        public int ModeloCalcadoId { get; set; }
        public virtual ModeloCalcado ModeloCalcado { get; set; }
        
        [Range(1, 50, ErrorMessage = "O tamanho deve estar entre 1 e 50")]
        public int Tamanho { get; set; }
        
        [Display(Name = "Grade Padrão")]
        public bool GradePadrao { get; set; }
    }

    public class CorDisponivel
    {
        public int Id { get; set; }
        public int ModeloCalcadoId { get; set; }
        public virtual ModeloCalcado ModeloCalcado { get; set; }
        
        [Required(ErrorMessage = "O nome da cor é obrigatório")]
        [StringLength(50, ErrorMessage = "O nome não pode exceder 50 caracteres")]
        public string Nome { get; set; }
        
        [RegularExpression(@"^#([A-Fa-f0-9]{6})$", ErrorMessage = "O código de cor deve estar no formato hexadecimal (#RRGGBB)")]
        [Display(Name = "Código Hexadecimal")]
        public string CodigoHexadecimal { get; set; }
        
        [Display(Name = "Cor Padrão")]
        public bool CorPadrao { get; set; }
    }

    
	public class MaterialUtilizado
	{
	    public int Id { get; set; }
	    public int ModeloCalcadoId { get; set; }
	    public virtual ModeloCalcado ModeloCalcado { get; set; }
	    public int MaterialId { get; set; }
	    public virtual Material Material { get; set; }
    
	    [Required(ErrorMessage = "A parte do calçado é obrigatória")]
	    [StringLength(50, ErrorMessage = "O nome da parte não pode exceder 50 caracteres")]
	    public string Parte { get; set; }
    
	    [Required(ErrorMessage = "A quantidade é obrigatória")]
	    [Range(0.01, 1000, ErrorMessage = "A quantidade deve estar entre 0,01 e 1000")]
	    [Column(TypeName = "decimal(10, 3)")]
	    public decimal Quantidade { get; set; }
    
	    [NotMapped]
	    public decimal CustoTotal 
	    { 
	        get 
	        {
	            if (Material != null)
	            {
	                return Quantidade * Material.PrecoUnitario;
	            }
	            return 0;
	        } 
	    }
	}
```

```csharp
public class MaterialUtilizado
{
    public int Id { get; set; }
    public int ModeloCalcadoId { get; set; }
    public virtual ModeloCalcado ModeloCalcado { get; set; }
    public int MaterialId { get; set; }
    public virtual Material Material { get; set; }
    
    [Required(ErrorMessage = "A parte do calçado é obrigatória")]
    [StringLength(50, ErrorMessage = "O nome da parte não pode exceder 50 caracteres")]
    public string Parte { get; set; }
    
    [Required(ErrorMessage = "A quantidade é obrigatória")]
    [Range(0.01, 1000, ErrorMessage = "A quantidade deve estar entre 0,01 e 1000")]
    [Column(TypeName = "decimal(10, 3)")]
    public decimal Quantidade { get; set; }
    
    [NotMapped]
    public decimal CustoTotal 
    { 
        get 
        {
            if (Material != null)
            {
                return Quantidade * Material.PrecoUnitario;
            }
            return 0;
        } 
    }
}
```

