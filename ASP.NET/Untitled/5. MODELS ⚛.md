## 5.1 Definição de Models

Os models no ASP.NET Core MVC representam os dados e a lógica de negócios da aplicação. Em uma fábrica de calçados, os models vão representar entidades como modelos de calçados, ordens de produção, materiais, funcionários, entre outros.

==Exemplo de model básico para um modelo de calçado:==
```csharp
namespace CalcadosOmega.Models
{
    public class ModeloCalcado
    {
        public int Id { get; set; }
        public string Codigo { get; set; }
        public string Nome { get; set; }
        public string Descricao { get; set; }
        public decimal PrecoBase { get; set; }
        public string Categoria { get; set; }
        public string Genero { get; set; }
        public bool Ativo { get; set; }
        public DateTime DataCriacao { get; set; }
        public string ImagemUrl { get; set; }
        public ICollection<TamanhoDisponivel> TamanhosDisponiveis { get; set; }
        public ICollection<CorDisponivel> CoresDisponiveis { get; set; }
        public ICollection<MaterialUtilizado> Materiais { get; set; }
    }

	public class TamanhoDisponivel
	{
	    public int Id { get; set; }
	    public int ModeloCalcadoId { get; set; }
	    public ModeloCalcado ModeloCalcado { get; set; }
	    public int Tamanho { get; set; }
	    public bool TemEstoque { get; set; }
	}

	public class CorDisponivel
	{
	    public int Id { get; set; }
	    public int ModeloCalcadoId { get; set; }
	    public ModeloCalcado ModeloCalcado { get; set; }
	    public string Nome { get; set; }
	    public string CodigoHexadecimal { get; set; }
	}

	public class MaterialUtilizado
	{
	    public int Id { get; set; }
	    public int ModeloCalcadoId { get; set; }
	    public ModeloCalcado ModeloCalcado { get; set; }
	    public int MaterialId { get; set; }
	    public Material Material { get; set; }
	    public string Parte { get; set; } // Ex: Solado, Cabedal, Forro
	    public decimal Quantidade { get; set; }
	    public string UnidadeMedida { get; set; }
	}

	public class Material
	{
	    public int Id { get; set; }
	    public string Codigo { get; set; }
	    public string Nome { get; set; }
	    public string Descricao { get; set; }
	    public string UnidadeMedida { get; set; }
	    public decimal PrecoUnitario { get; set; }
	    public int EstoqueMinimo { get; set; }
	    public int EstoqueAtual { get; set; }
	    public ICollection<MaterialUtilizado> UtilizadoEm { get; set; }
	    public ICollection<FornecedorMaterial> Fornecedores { get; set; }
}
```


Exemplo de model para turnos de produção:

```csharp
public class TurnoProducao
{
    public int Id { get; set; }
    public DateTime DataInicio { get; set; }
    public DateTime? DataFim { get; set; }
    public string Supervisor { get; set; }
    public string TipoTurno { get; set; } // Manhã, Tarde, Noite
    public string Status { get; set; } // Em Andamento, Concluído, Cancelado
    public ICollection<ItemProducao> ItensProduzidos { get; set; }
    public ICollection<ParadaProducao> Paradas { get; set; }
    public string Observacoes { get; set; }
}

public class ItemProducao
{
    public int Id { get; set; }
    public int TurnoProducaoId { get; set; }
    public TurnoProducao TurnoProducao { get; set; }
    public int ModeloCalcadoId { get; set; }
    public ModeloCalcado ModeloCalcado { get; set; }
    public int Tamanho { get; set; }
    public string Cor { get; set; }
    public int QuantidadePlanejada { get; set; }
    public int QuantidadeProduzida { get; set; }
    public int QuantidadeDefeituosa { get; set; }
    public DateTime HoraRegistro { get; set; }
}

public class ParadaProducao
{
    public int Id { get; set; }
    public int TurnoProducaoId { get; set; }
    public TurnoProducao TurnoProducao { get; set; }
    public DateTime HoraInicio { get; set; }
    public DateTime? HoraFim { get; set; }
    public string Motivo { get; set; }
    public string Descricao { get; set; }
    public string ResponsavelSolucao { get; set; }
    public string AcaoCorretiva { get; set; }
    public bool AcaoPreventiva { get; set; }
}
```

## 5.2 Data Annotations

As Data Annotations são atributos que podem ser aplicados às propriedades dos models para adicionar regras de validação e definir metadados para a exibição:

```csharp
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace CalcadosOmega.Models
{
    public class ModeloCalcado
    {
        public int Id { get; set; }
        
        [Required(ErrorMessage = "O código do modelo é obrigatório")]
        [StringLength(10, MinimumLength = 4, ErrorMessage = "O código deve ter entre 4 e 10 caracteres")]
        [Display(Name = "Código do Modelo")]
        public string Codigo { get; set; }
        
        [Required(ErrorMessage = "O nome do modelo é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome não pode exceder 100 caracteres")]
        [Display(Name = "Nome do Modelo")]
        public string Nome { get; set; }
        
        [DataType(DataType.MultilineText)]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        [Required(ErrorMessage = "O preço base é obrigatório")]
        [Range(0.01, 9999.99, ErrorMessage = "O preço deve estar entre R$ 0,01 e R$ 9.999,99")]
        [DataType(DataType.Currency)]
        [Column(TypeName = "decimal(10, 2)")]
        [Display(Name = "Preço Base")]
        public decimal PrecoBase { get; set; }
        
        [Required(ErrorMessage = "A categoria é obrigatória")]
        public string Categoria { get; set; }
        
        [Required(ErrorMessage = "O gênero é obrigatório")]
        public string Genero { get; set; }
        
        [Display(Name = "Modelo Ativo")]
        public bool Ativo { get; set; }
        
        [DataType(DataType.Date)]
        [Display(Name = "Data de Criação")]
        public DateTime DataCriacao { get; set; }
        
        [Url(ErrorMessage = "A URL da imagem deve ser válida")]
        [Display(Name = "URL da Imagem")]
        public string ImagemUrl { get; set; }
        
        // Validação personalizada para verificar código único
        public class CodigoUnicoAttribute : ValidationAttribute
        {
            protected override ValidationResult IsValid(object value, ValidationContext validationContext)
            {
                var model = (ModeloCalcado)validationContext.ObjectInstance;
                var dbContext = (ApplicationDbContext)validationContext
                    .GetService(typeof(ApplicationDbContext));
                
                var existeCodigo = dbContext.ModelosCalcado
                    .Any(m => m.Codigo == model.Codigo && m.Id != model.Id);
                
                if (existeCodigo)
                {
                    return new ValidationResult("Este código já está em uso.");
                }
                
                return ValidationResult.Success;
            }
        }
    }
    
    public class TurnoProducao
    {
        public int Id { get; set; }
        
        [Required(ErrorMessage = "A data de início é obrigatória")]
        [DataType(DataType.DateTime)]
        [Display(Name = "Data de Início")]
        public DateTime DataInicio { get; set; }
        
        [DataType(DataType.DateTime)]
        [Display(Name = "Data de Encerramento")]
        public DateTime? DataFim { get; set; }
        
        [Required(ErrorMessage = "O supervisor é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome do supervisor não pode exceder 100 caracteres")]
        public string Supervisor { get; set; }
        
        [Required(ErrorMessage = "O tipo de turno é obrigatório")]
        [Display(Name = "Tipo de Turno")]
        public string TipoTurno { get; set; }
        
        [Required(ErrorMessage = "O status é obrigatório")]
        public string Status { get; set; }
        
        [DataType(DataType.MultilineText)]
        [StringLength(500, ErrorMessage = "As observações não podem exceder 500 caracteres")]
        [Display(Name = "Observações")]
        public string Observacoes { get; set; }
        
        // Validação personalizada para verificar se a data de fim é posterior à data de início
        public class DataFimValidaAttribute : ValidationAttribute
        {
            protected override ValidationResult IsValid(object value, ValidationContext validationContext)
            {
                var turno = (TurnoProducao)validationContext.ObjectInstance;
                
                if (turno.DataFim.HasValue && turno.DataFim < turno.DataInicio)
                {
                    return new ValidationResult("A data de encerramento deve ser posterior à data de início.");
                }
                
                return ValidationResult.Success;
            }
        }
    }
}
```

## 5.3 ViewModels

Os ViewModels são classes específicas para as views que combinam dados de diferentes modelos ou apresentam apenas um subconjunto de propriedades de um modelo. Eles são úteis para adaptar os dados às necessidades específicas de uma view.

```csharp
namespace CalcadosOmega.ViewModels
{
    public class CatalogoModelosViewModel
    {
        public List<ModeloCalcado> ModelosAtivos { get; set; }
        public List<string> CategoriasDisponiveis { get; set; }
        public List<string> GenerosDisponiveis { get; set; }
        public string CategoriaAtual { get; set; }
        public string GeneroAtual { get; set; }
        public int TotalModelos { get; set; }
        public int Pagina { get; set; }
        public int TamanhoPagina { get; set; }
        public bool TemProximaPagina { get; set; }
    }
    
    public class DetalhesModeloViewModel
    {
        public ModeloCalcado Modelo { get; set; }
        public List<TamanhoDisponivel> TamanhosEmEstoque { get; set; }
        public List<CorDisponivel> CoresDisponiveis { get; set; }
        public Dictionary<string, decimal> QuantidadesMateriais { get; set; }
        public decimal CustoTotal { get; set; }
        public decimal MargemLucro { get; set; }
        public int QuantidadeProduzidaTotal { get; set; }
        public int QuantidadeProduzidaMes { get; set; }
    }
    
    public class DashboardProducaoViewModel
    {
        public TurnoProducao TurnoAtual { get; set; }
        public List<ItemProducao> UltimosItensProduzidos { get; set; }
        public Dictionary<string, int> ProducaoPorModelo { get; set; }
        public Dictionary<string, int> ProducaoPorCategoria { get; set; }
        public int TotalProduzidoHoje { get; set; }
        public int TotalProduzidoSemana { get; set; }
        public int TotalProduzidoMes { get; set; }
        public decimal EficienciaAtual { get; set; }
        public List<ParadaProducao> ParadasRecentes { get; set; }
        public int TempoTotalParadas { get; set; }
        public Dictionary<string, int> MotivoParadas { get; set; }
    }
    
    public class RelatorioProducaoViewModel
    {
        public DateTime DataInicio { get; set; }
        public DateTime DataFim { get; set; }
        public List<TurnoProducao> Turnos { get; set; }
        public int TotalProduzido { get; set; }
        public int TotalDefeituoso { get; set; }
        public decimal TaxaDefeito { get; set; }
        public decimal EficienciaMedia { get; set; }
        public Dictionary<string, int> ProducaoPorModelo { get; set; }
        public Dictionary<string, int> ProducaoPorSupervisor { get; set; }
        public Dictionary<string, int> ProducaoPorTurno { get; set; }
        public Dictionary<string, TimeSpan> TempoParadaPorMotivo { get; set; }
    }
    
    public class GerenciamentoEstoqueViewModel
    {
        public List<Material> MateriaisEmBaixoEstoque { get; set; }
        public Dictionary<int, int> ConsumoMensalPorMaterial { get; set; }
        public Dictionary<int, DateTime> UltimaCompraData { get; set; }
        public Dictionary<int, List<Fornecedor>> FornecedoresPorMaterial { get; set; }
        public List<OrdemCompra> OrdensCompraEmAberto { get; set; }
    }
}
```

## 5.4 Prática: Implementando Models para Gestão de Calçados

Vamos implementar uma estrutura de models completa para a fábrica de calçados, considerando diferentes aspectos do negócio:

### Models de Domínio

**Models/Producao/ModeloCalcado.cs**

csharpresponse-action-icon

```csharp
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace CalcadosOmega.Models.Producao
{
    public class ModeloCalcado
    {
        public ModeloCalcado()
        {
            TamanhosDisponiveis = new HashSet<TamanhoDisponivel>();
            CoresDisponiveis = new HashSet<CorDisponivel>();
            Materiais = new HashSet<MaterialUtilizado>();
            ItensProducao = new HashSet<ItemProducao>();
            DataCriacao = DateTime.Now;
            Ativo = true;
        }

        public int Id { get; set; }
        
        [Required(ErrorMessage = "O código do modelo é obrigatório")]
        [StringLength(15, MinimumLength = 4, ErrorMessage = "O código deve ter entre 4 e 15 caracteres")]
        [RegularExpression(@"^[A-Z0-9\-]+$", ErrorMessage = "O código deve conter apenas letras maiúsculas, números e hífens")]
        [Display(Name = "Código")]
        public string Codigo { get; set; }
        
        [Required(ErrorMessage = "O nome do modelo é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome não pode exceder 100 caracteres")]
        public string Nome { get; set; }
        
        [DataType(DataType.MultilineText)]
        [StringLength(500, ErrorMessage = "A descrição não pode exceder 500 caracteres")]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        [Required(ErrorMessage = "A categoria é obrigatória")]
        public int CategoriaId { get; set; }
        
        [ForeignKey("CategoriaId")]
        public virtual CategoriaCalcado Categoria { get; set; }
        
        [Required(ErrorMessage = "O gênero é obrigatório")]
        public string Genero { get; set; }
        
        [Required(ErrorMessage = "O preço base é obrigatório")]
        [Range(0.01, 9999.99, ErrorMessage = "O preço deve estar entre R$ 0,01 e R$ 9.999,99")]
        [DataType(DataType.Currency)]
        [Column(TypeName = "decimal(10, 2)")]
        [Display(Name = "Preço Base")]
        public decimal PrecoBase { get; set; }
        
        [Display(Name = "Tempo de Produção (min)")]
        [Range(1, 1000, ErrorMessage = "O tempo de produção deve estar entre 1 e 1000 minutos")]
        public int TempoProducaoMinutos { get; set; }
        
        [Display(Name = "Modelo Ativo")]
        public bool Ativo { get; set; }
        
        [DataType(DataType.Date)]
        [Display(Name = "Data de Criação")]
        public DateTime DataCriacao { get; set; }
        
        [Url(ErrorMessage = "A URL da imagem deve ser válida")]
        [Display(Name = "URL da Imagem")]
        public string ImagemUrl { get; set; }
        
        [StringLength(1000, ErrorMessage = "As instruções de fabricação não podem exceder 1000 caracteres")]
        [DataType(DataType.MultilineText)]
        [Display(Name = "Instruções de Fabricação")]
        public string InstrucoesFabricacao { get; set; }
        
        [Display(Name = "Referência do Designer")]
        public string ReferenciaDesigner { get; set; }
        
        public virtual ICollection<TamanhoDisponivel> TamanhosDisponiveis { get; set; }
        public virtual ICollection<CorDisponivel> CoresDisponiveis { get; set; }
        public virtual ICollection<MaterialUtilizado> Materiais { get; set; }
        public virtual ICollection<ItemProducao> ItensProducao { get; set; }
        
        [NotMapped]
        public decimal CustoTotal 
        { 
            get 
            {
                decimal custo = 0;
                foreach (var material in Materiais)
                {
                    custo += material.CustoTotal;
                }
                return custo;
            } 
        }
        
        [NotMapped]
        public decimal MargemLucro 
        { 
            get 
            {
                if (CustoTotal > 0)
                {
                    return (PrecoBase - CustoTotal) / CustoTotal * 100;
                }
                return 0;
            } 
        }
        
        public string ObterCodigoCompleto()
        {
            return $"{Categoria?.Sigla ?? "XX"}-{Codigo}-{Genero.Substring(0, 1)}";
        }
    }

    public class CategoriaCalcado
    {
        public CategoriaCalcado()
        {
            Modelos = new HashSet<ModeloCalcado>();
        }

        public int Id { get; set; }
        
        [Required(ErrorMessage = "O nome da categoria é obrigatório")]
        [StringLength(50, ErrorMessage = "O nome não pode exceder 50 caracteres")]
        public string Nome { get; set; }
        
        [Required(ErrorMessage = "A sigla da categoria é obrigatória")]
        [StringLength(3, MinimumLength = 2, ErrorMessage = "A sigla deve ter 2 ou 3 caracteres")]
        public string Sigla { get; set; }
        
        [DataType(DataType.MultilineText)]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        public virtual ICollection<ModeloCalcado> Modelos { get; set; }
    }

    public class TamanhoDisponivel
    {
        public int Id { get; set; }
        public int ModeloCalcadoId { get; set; }
        public virtual ModeloCalcado ModeloCalcado { get; set; }
        
        [Range(1, 50, ErrorMessage = "O tamanho deve estar entre 1 e 50")]
        public int Tamanho { get; set; }
        
        [Display(Name = "Grade Padrão")]
        public bool GradePadrao { get; set; }
    }

    public class CorDisponivel
    {
        public int Id { get; set; }
        public int ModeloCalcadoId { get; set; }
        public virtual ModeloCalcado ModeloCalcado { get; set; }
        
        [Required(ErrorMessage = "O nome da cor é obrigatório")]
        [StringLength(50, ErrorMessage = "O nome não pode exceder 50 caracteres")]
        public string Nome { get; set; }
        
        [RegularExpression(@"^#([A-Fa-f0-9]{6})$", ErrorMessage = "O código de cor deve estar no formato hexadecimal (#RRGGBB)")]
        [Display(Name = "Código Hexadecimal")]
        public string CodigoHexadecimal { get; set; }
        
        [Display(Name = "Cor Padrão")]
        public bool CorPadrao { get; set; }
    }

    
	public class MaterialUtilizado
	{
	    public int Id { get; set; }
	    public int ModeloCalcadoId { get; set; }
	    public virtual ModeloCalcado ModeloCalcado { get; set; }
	    public int MaterialId { get; set; }
	    public virtual Material Material { get; set; }
    
	    [Required(ErrorMessage = "A parte do calçado é obrigatória")]
	    [StringLength(50, ErrorMessage = "O nome da parte não pode exceder 50 caracteres")]
	    public string Parte { get; set; }
    
	    [Required(ErrorMessage = "A quantidade é obrigatória")]
	    [Range(0.01, 1000, ErrorMessage = "A quantidade deve estar entre 0,01 e 1000")]
	    [Column(TypeName = "decimal(10, 3)")]
    public decimal Quantidade { get; set; }
    
	    [NotMapped]
	    public decimal CustoTotal 
	    { 
	        get 
	        {
	            if (Material != null)
            {
                return Quantidade * Material.PrecoUnitario;
            }
            return 0;
        } 
    }
}
```



**Models/Materiais/Material.cs**

```csharp
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using CalcadosOmega.Models.Producao;

namespace CalcadosOmega.Models.Materiais
{
    public class Material
    {
        public Material()
        {
            UtilizadoEm = new HashSet<MaterialUtilizado>();
            Fornecedores = new HashSet<FornecedorMaterial>();
            Movimentacoes = new HashSet<MovimentacaoEstoque>();
        }

        public int Id { get; set; }
        
        [Required(ErrorMessage = "O código do material é obrigatório")]
        [StringLength(20, ErrorMessage = "O código não pode exceder 20 caracteres")]
        [Display(Name = "Código")]
        public string Codigo { get; set; }
        
        [Required(ErrorMessage = "O nome do material é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome não pode exceder 100 caracteres")]
        public string Nome { get; set; }
        
        [DataType(DataType.MultilineText)]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        [Required(ErrorMessage = "A unidade de medida é obrigatória")]
        [StringLength(10, ErrorMessage = "A unidade de medida não pode exceder 10 caracteres")]
        [Display(Name = "Unidade de Medida")]
        public string UnidadeMedida { get; set; }
        
        [Required(ErrorMessage = "O preço unitário é obrigatório")]
        [Range(0.01, 99999.99, ErrorMessage = "O preço deve estar entre R$ 0,01 e R$ 99.999,99")]
        [DataType(DataType.Currency)]
        [Column(TypeName = "decimal(10, 2)")]
        [Display(Name = "Preço Unitário")]
        public decimal PrecoUnitario { get; set; }
        
        [Required(ErrorMessage = "O estoque mínimo é obrigatório")]
        [Range(1, 9999, ErrorMessage = "O estoque mínimo deve estar entre 1 e 9999")]
        [Display(Name = "Estoque Mínimo")]
        public int EstoqueMinimo { get; set; }
        
        [Display(Name = "Estoque Atual")]
        public int EstoqueAtual { get; set; }
        
        [Display(Name = "Ponto de Reposição")]
        public int PontoReposicao { get; set; }
        
        [Display(Name = "Tempo de Reposição (dias)")]
        [Range(1, 365, ErrorMessage = "O tempo de reposição deve estar entre 1 e 365 dias")]
        public int TempoReposicaoDias { get; set; }
        
        [Required(ErrorMessage = "A categoria do material é obrigatória")]
        public int CategoriaMaterialId { get; set; }
        
        [ForeignKey("CategoriaMaterialId")]
        public virtual CategoriaMaterial Categoria { get; set; }
        
        [Display(Name = "Material Ativo")]
        public bool Ativo { get; set; }
        
        [Display(Name = "Localização no Almoxarifado")]
        public string LocalizacaoAlmoxarifado { get; set; }
        
        public virtual ICollection<MaterialUtilizado> UtilizadoEm { get; set; }
        public virtual ICollection<FornecedorMaterial> Fornecedores { get; set; }
        public virtual ICollection<MovimentacaoEstoque> Movimentacoes { get; set; }
        
        [NotMapped]
        public bool EmBaixoEstoque => EstoqueAtual <= EstoqueMinimo;
        
        [NotMapped]
        public bool NecessitaReposicao => EstoqueAtual <= PontoReposicao;
        
        [NotMapped]
        public decimal ValorTotalEstoque => EstoqueAtual * PrecoUnitario;
    }

    public class CategoriaMaterial
    {
        public CategoriaMaterial()
        {
            Materiais = new HashSet<Material>();
        }

        public int Id { get; set; }
        
        [Required(ErrorMessage = "O nome da categoria é obrigatório")]
        [StringLength(50, ErrorMessage = "O nome não pode exceder 50 caracteres")]
        public string Nome { get; set; }
        
        [DataType(DataType.MultilineText)]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        public virtual ICollection<Material> Materiais { get; set; }
    }

    public class FornecedorMaterial
    {
        public int Id { get; set; }
        public int MaterialId { get; set; }
        public virtual Material Material { get; set; }
        public int FornecedorId { get; set; }
        public virtual Fornecedor Fornecedor { get; set; }
        
        [Range(0.01, 99999.99, ErrorMessage = "O preço deve estar entre R$ 0,01 e R$ 99.999,99")]
        [DataType(DataType.Currency)]
        [Column(TypeName = "decimal(10, 2)")]
        [Display(Name = "Preço Fornecedor")]
        public decimal PrecoFornecedor { get; set; }
        
        [Display(Name = "Fornecedor Preferencial")]
        public bool Preferencial { get; set; }
        
        [Display(Name = "Prazo de Entrega (dias)")]
        [Range(1, 365, ErrorMessage = "O prazo de entrega deve estar entre 1 e 365 dias")]
        public int PrazoEntregaDias { get; set; }
        
        [StringLength(100, ErrorMessage = "A referência do fornecedor não pode exceder 100 caracteres")]
        [Display(Name = "Referência do Fornecedor")]
        public string ReferenciaFornecedor { get; set; }
        
        [Display(Name = "Última Compra")]
        [DataType(DataType.Date)]
        public DateTime? UltimaCompra { get; set; }
    }

    public class MovimentacaoEstoque
    {
        public int Id { get; set; }
        public int MaterialId { get; set; }
        public virtual Material Material { get; set; }
        
        [Required(ErrorMessage = "A data da movimentação é obrigatória")]
        [Display(Name = "Data")]
        public DateTime Data { get; set; }
        
        [Required(ErrorMessage = "O tipo de movimentação é obrigatório")]
        [Display(Name = "Tipo")]
        public string Tipo { get; set; } // Entrada, Saída, Ajuste
        
        [Required(ErrorMessage = "A quantidade é obrigatória")]
        [Range(0.01, 99999.99, ErrorMessage = "A quantidade deve estar entre 0,01 e 99.999,99")]
        public decimal Quantidade { get; set; }
        
        [Required(ErrorMessage = "O documento de referência é obrigatório")]
        [StringLength(30, ErrorMessage = "O documento não pode exceder 30 caracteres")]
        [Display(Name = "Documento")]
        public string DocumentoReferencia { get; set; }
        
        [Display(Name = "Observações")]
        [DataType(DataType.MultilineText)]
        public string Observacoes { get; set; }
        
        [Required(ErrorMessage = "O responsável é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome do responsável não pode exceder 100 caracteres")]
        [Display(Name = "Responsável")]
        public string Responsavel { get; set; }
        
        public int? OrdemCompraId { get; set; }
        public virtual OrdemCompra OrdemCompra { get; set; }
        
        public int? TurnoProducaoId { get; set; }
        public virtual TurnoProducao TurnoProducao { get; set; }
    }
}
```

**Models/Producao/TurnoProducao.cs**

```csharp
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using System.Linq;
using CalcadosOmega.Models.Materiais;

namespace CalcadosOmega.Models.Producao
{
    public class TurnoProducao
    {
        public TurnoProducao()
        {
            ItensProduzidos = new HashSet<ItemProducao>();
            Paradas = new HashSet<ParadaProducao>();
            MovimentacoesMateriais = new HashSet<MovimentacaoEstoque>();
            Status = "Em Preparação";
            DataCriacao = DateTime.Now;
        }

        public int Id { get; set; }
        
        [Required(ErrorMessage = "A data do turno é obrigatória")]
        [DataType(DataType.Date)]
        [Display(Name = "Data")]
        public DateTime Data { get; set; }
        
        [Required(ErrorMessage = "A hora de início é obrigatória")]
        [DataType(DataType.Time)]
        [Display(Name = "Hora de Início")]
        public TimeSpan HoraInicio { get; set; }
        
        [DataType(DataType.Time)]
        [Display(Name = "Hora de Término")]
        public TimeSpan? HoraTermino { get; set; }
        
        [Required(ErrorMessage = "O supervisor é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome do supervisor não pode exceder 100 caracteres")]
        public string Supervisor { get; set; }
        
        [Required(ErrorMessage = "O tipo de turno é obrigatório")]
        [Display(Name = "Tipo de Turno")]
        public string TipoTurno { get; set; } // Manhã, Tarde, Noite
        
        [Required(ErrorMessage = "O status é obrigatório")]
        public string Status { get; set; } // Em Preparação, Em Andamento, Concluído, Cancelado
        
        [Display(Name = "Linha de Produção")]
        public int LinhaProducaoId { get; set; }
        
        [ForeignKey("LinhaProducaoId")]
        public virtual LinhaProducao LinhaProducao { get; set; }
        
        [Display(Name = "Data de Criação")]
        public DateTime DataCriacao { get; set; }
        
        [Display(Name = "Data de Encerramento")]
        public DateTime? DataEncerramento { get; set; }
        
        [DataType(DataType.MultilineText)]
        [StringLength(500, ErrorMessage = "As observações não podem exceder 500 caracteres")]
        [Display(Name = "Observações")]
        public string Observacoes { get; set; }
        
        [Range(0, 100, ErrorMessage = "A eficiência deve estar entre 0 e 100%")]
        [Display(Name = "Eficiência (%)")]
        public decimal? EficienciaCalculada { get; set; }
        
        public virtual ICollection<ItemProducao> ItensProduzidos { get; set; }
        public virtual ICollection<ParadaProducao> Paradas { get; set; }
        public virtual ICollection<MovimentacaoEstoque> MovimentacoesMateriais { get; set; }
        
        [NotMapped]
        public TimeSpan DuracaoTotal
        {
            get
            {
                if (!HoraTermino.HasValue)
                    return TimeSpan.Zero;
                    
                return HoraTermino.Value - HoraInicio;
            }
        }
        
        [NotMapped]
        public TimeSpan TempoParadas
        {
            get
            {
                TimeSpan total = TimeSpan.Zero;
                
                foreach (var parada in Paradas.Where(p => p.HoraFim.HasValue))
                {
                    total += parada.HoraFim.Value - parada.HoraInicio;
                }
                
                return total;
            }
        }
        
        [NotMapped]
        public TimeSpan TempoEfetivo => DuracaoTotal - TempoParadas;
        
        [NotMapped]
        public int TotalProduzido => ItensProduzidos.Sum(i => i.QuantidadeProduzida);
        
        [NotMapped]
        public int TotalDefeituoso => ItensProduzidos.Sum(i => i.QuantidadeDefeituosa);
        
        [NotMapped]
        public decimal TaxaDefeito
        {
            get
            {
                if (TotalProduzido == 0)
                    return 0;
                    
                return (decimal)TotalDefeituoso / TotalProduzido * 100;
            }
        }
    }

    public class ItemProducao
    {
        public int Id { get; set; }
        public int TurnoProducaoId { get; set; }
        public virtual TurnoProducao TurnoProducao { get; set; }
        public int ModeloCalcadoId { get; set; }
        public virtual ModeloCalcado ModeloCalcado { get; set; }
        
        [Range(1, 50, ErrorMessage = "O tamanho deve estar entre 1 e 50")]
        public int Tamanho { get; set; }
        
        [StringLength(50, ErrorMessage = "O nome da cor não pode exceder 50 caracteres")]
        public string Cor { get; set; }
        
        [Required(ErrorMessage = "A quantidade planejada é obrigatória")]
        [Range(1, 10000, ErrorMessage = "A quantidade planejada deve estar entre 1 e 10000")]
        [Display(Name = "Qtd. Planejada")]
        public int QuantidadePlanejada { get; set; }
        
        [Range(0, 10000, ErrorMessage = "A quantidade produzida deve estar entre 0 e 10000")]
        [Display(Name = "Qtd. Produzida")]
        public int QuantidadeProduzida { get; set; }
        
        [Range(0, 10000, ErrorMessage = "A quantidade defeituosa deve estar entre 0 e 10000")]
        [Display(Name = "Qtd. Defeituosa")]
        public int QuantidadeDefeituosa { get; set; }
        
        [Display(Name = "Hora do Registro")]
        public DateTime HoraRegistro { get; set; }
        
        [Display(Name = "Operador")]
        [StringLength(100, ErrorMessage = "O nome do operador não pode exceder 100 caracteres")]
        public string Operador { get; set; }
        
        [Display(Name = "Observações")]
        [DataType(DataType.MultilineText)]
        public string Observacoes { get; set; }
        
        [NotMapped]
        public int QuantidadePendente => QuantidadePlanejada - QuantidadeProduzida;
        
        [NotMapped]
        public decimal PercentualConcluido
        {
            get
            {
                if (QuantidadePlanejada == 0)
                    return 0;
                    
                return (decimal)QuantidadeProduzida / QuantidadePlanejada * 100;
            }
        }
        
        [NotMapped]
        public decimal PercentualDefeito
        {
            get
            {
                if (QuantidadeProduzida == 0)
                    return 0;
                    
                return (decimal)QuantidadeDefeituosa / QuantidadeProduzida * 100;
            }
        }
    }

    public class ParadaProducao
    {
        public int Id { get; set; }
        public int TurnoProducaoId { get; set; }
        public virtual TurnoProducao TurnoProducao { get; set; }
        
        [Required(ErrorMessage = "A hora de início é obrigatória")]
        [Display(Name = "Hora de Início")]
        public TimeSpan HoraInicio { get; set; }
        
        [Display(Name = "Hora de Término")]
        public TimeSpan? HoraFim { get; set; }
        
        [Required(ErrorMessage = "O motivo da parada é obrigatório")]
        [Display(Name = "Motivo")]
        public string Motivo { get; set; } // Manutenção, Setup, Falta de Material, etc.
        
        [DataType(DataType.MultilineText)]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        [Display(Name = "Responsável pela Solução")]
        public string ResponsavelSolucao { get; set; }
        
        [DataType(DataType.MultilineText)]
        [Display(Name = "Ação Corretiva")]
        public string AcaoCorretiva { get; set; }
        
        [Display(Name = "Ação Preventiva Implementada")]
        public bool AcaoPreventiva { get; set; }
        
        [NotMapped]
        public TimeSpan Duracao
        {
            get
            {
                if (!HoraFim.HasValue)
                    return TimeSpan.Zero;
                    
                return HoraFim.Value - HoraInicio;
            }
        }
    }

    public class LinhaProducao
    {
        public LinhaProducao()
        {
            Turnos = new HashSet<TurnoProducao>();
        }

        public int Id { get; set; }
        
        [Required(ErrorMessage = "O nome da linha é obrigatório")]
        [StringLength(50, ErrorMessage = "O nome não pode exceder 50 caracteres")]
        public string Nome { get; set; }
        
        [DataType(DataType.MultilineText)]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        [Range(1, 1000, ErrorMessage = "A capacidade deve estar entre 1 e 1000")]
        [Display(Name = "Capacidade (pares/hora)")]
        public int CapacidadePorHora { get; set; }
        
        [Display(Name = "Ativa")]
        public bool Ativa { get; set; }
        
        public virtual ICollection<TurnoProducao> Turnos { get; set; }
    }
}
```


### ViewModels

**ViewModels/Producao/ModeloCalcadoViewModel.cs**

csharpresponse-action-icon

```csharp
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using Microsoft.AspNetCore.Http;
using CalcadosOmega.Models.Producao;

namespace CalcadosOmega.ViewModels.Producao
{
    public class ModeloCalcadoViewModel
    {
        public int Id { get; set; }
        
        [Required(ErrorMessage = "O código do modelo é obrigatório")]
        [StringLength(15, MinimumLength = 4, ErrorMessage = "O código deve ter entre 4 e 15 caracteres")]
        [RegularExpression(@"^[A-Z0-9\-]+$", ErrorMessage = "O código deve conter apenas letras maiúsculas, números e hífens")]
        [Display(Name = "Código")]
        public string Codigo { get; set; }
        
        [Required(ErrorMessage = "O nome do modelo é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome não pode exceder 100 caracteres")]
        public string Nome { get; set; }
        
        [DataType(DataType.MultilineText)]
        [StringLength(500, ErrorMessage = "A descrição não pode exceder 500 caracteres")]
        [Display(Name = "Descrição")]
        public string Descricao { get; set; }
        
        [Required(ErrorMessage = "A categoria é obrigatória")]
        [Display(Name = "Categoria")]
        public int CategoriaId { get; set; }
  
	[Required(ErrorMessage = "O gênero é obrigatório")]
[Display(Name = "Gênero")]
public string Genero { get; set; }

[Required(ErrorMessage = "O preço base é obrigatório")]
[Range(0.01, 9999.99, ErrorMessage = "O preço deve estar entre R$ 0,01 e R$ 9.999,99")]
[DataType(DataType.Currency)]
[Display(Name = "Preço Base")]
public decimal PrecoBase { get; set; }

[Display(Name = "Tempo de Produção (min)")]
[Range(1, 1000, ErrorMessage = "O tempo de produção deve estar entre 1 e 1000 minutos")]
public int TempoProducaoMinutos { get; set; }

[Display(Name = "Modelo Ativo")]
public bool Ativo { get; set; }

[Display(Name = "Imagem do Modelo")]
public IFormFile ImagemUpload { get; set; }

[Display(Name = "Imagem Atual")]
public string ImagemUrl { get; set; }

[StringLength(1000, ErrorMessage = "As instruções de fabricação não podem exceder 1000 caracteres")]
[DataType(DataType.MultilineText)]
[Display(Name = "Instruções de Fabricação")]
public string InstrucoesFabricacao { get; set; }

[Display(Name = "Referência do Designer")]
public string ReferenciaDesigner { get; set; }

public List<int> TamanhosSelecionados { get; set; }
public List<CorViewModel> CoresSelecionadas { get; set; }
public List<MaterialUtilizadoViewModel> MateriaisSelecionados { get; set; }

// Propriedades para exibição
public string CategoriaNome { get; set; }
public IEnumerable<CategoriaCalcado> CategoriasDisponiveis { get; set; }
public IEnumerable<int> TamanhosDisponiveis { get; set; }
public IEnumerable<Material> MateriaisDisponiveis { get; set; }
}

public class CorViewModel
{
    public int Id { get; set; }
    public string Nome { get; set; }
    public string CodigoHexadecimal { get; set; }
    public bool CorPadrao { get; set; }
}

public class MaterialUtilizadoViewModel
{
    public int Id { get; set; }
    
    [Required(ErrorMessage = "O material é obrigatório")]
    [Display(Name = "Material")]
    public int MaterialId { get; set; }
    
    [Required(ErrorMessage = "A parte é obrigatória")]
    [Display(Name = "Parte do Calçado")]
    public string Parte { get; set; }
    
    [Required(ErrorMessage = "A quantidade é obrigatória")]
    [Range(0.01, 1000, ErrorMessage = "A quantidade deve estar entre 0,01 e 1000")]
    public decimal Quantidade { get; set; }
    
    // Para exibição
    public string MaterialNome { get; set; }
    public string UnidadeMedida { get; set; }
    public decimal PrecoUnitario { get; set; }
    public decimal CustoTotal { get; set; }
}
```


**ViewModels/Producao/CatalogoModelosViewModel.cs**

csharpresponse-action-icon

```csharp
using System.Collections.Generic;
using CalcadosOmega.Models.Producao;

namespace CalcadosOmega.ViewModels.Producao
{
    public class CatalogoModelosViewModel
    {
        public List<ModeloCalcado> Modelos { get; set; }
        public List<CategoriaCalcado> Categorias { get; set; }
        public string[] Generos { get; set; }
        public string TermoBusca { get; set; }
        public int? CategoriaFiltro { get; set; }
        public string GeneroFiltro { get; set; }
        public bool MostrarInativos { get; set; }
        public int TotalModelos { get; set; }
        public int PaginaAtual { get; set; }
        public int TamanhoPagina { get; set; }
        public int TotalPaginas { get; set; }
        
        // Estatísticas
        public int TotalModelosAtivos { get; set; }
        public int TotalModelosInativos { get; set; }
        public Dictionary<string, int> ModelosPorCategoria { get; set; }
        public Dictionary<string, int> ModelosPorGenero { get; set; }
    }
}
```

**ViewModels/Producao/DetalhesModeloViewModel.cs**

csharpresponse-action-icon

```csharp
using System.Collections.Generic;
using CalcadosOmega.Models.Producao;
using CalcadosOmega.Models.Materiais;

namespace CalcadosOmega.ViewModels.Producao
{
    public class DetalhesModeloViewModel
    {
        public ModeloCalcado Modelo { get; set; }
        public List<TamanhoDisponivel> TamanhosDisponiveis { get; set; }
        public List<CorDisponivel> CoresDisponiveis { get; set; }
        public List<MaterialComFornecedor> MateriaisUtilizados { get; set; }
        
        // Estatísticas de produção
        public int ProducaoTotal { get; set; }
        public int ProducaoUltimos30Dias { get; set; }
        public int DefeituososTotal { get; set; }
        public decimal TaxaDefeitoMedia { get; set; }
        
        // Custos
        public decimal CustoMateriais { get; set; }
        public decimal CustoProducao { get; set; }
        public decimal CustoTotal { get; set; }
        public decimal MargemLucro { get; set; }
        
        // Histórico
        public List<ItemProducaoHistorico> HistoricoProducao { get; set; }
        
        // Disponibilidade
        public bool TodosMateriaisDisponiveis { get; set; }
        public Dictionary<int, bool> DisponibilidadeMaterial { get; set; }
    }
    
    public class MaterialComFornecedor
    {
        public MaterialUtilizado MaterialUtilizado { get; set; }
        public Material Material { get; set; }
        public Fornecedor FornecedorPrincipal { get; set; }
        public bool DisponibilidadeEstoque { get; set; }
        public int EstoqueAtual { get; set; }
        public decimal CustoTotal { get; set; }
    }
    
    public class ItemProducaoHistorico
    {
        public ItemProducao Item { get; set; }
        public TurnoProducao Turno { get; set; }
        public string Supervisor { get; set; }
        public string DataFormatada { get; set; }
        public int QuantidadeProduzida { get; set; }
        public int QuantidadeDefeituosa { get; set; }
        public decimal TaxaDefeito { get; set; }
    }
}
```

**ViewModels/Producao/TurnoProducaoViewModel.cs**

csharpresponse-action-icon

```csharp
using System;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using CalcadosOmega.Models.Producao;

namespace CalcadosOmega.ViewModels.Producao
{
    public class TurnoProducaoViewModel
    {
        public int Id { get; set; }
        
        [Required(ErrorMessage = "A data do turno é obrigatória")]
        [DataType(DataType.Date)]
        [Display(Name = "Data")]
        public DateTime Data { get; set; }
        
        [Required(ErrorMessage = "A hora de início é obrigatória")]
        [DataType(DataType.Time)]
        [Display(Name = "Hora de Início")]
        public TimeSpan HoraInicio { get; set; }
        
        [DataType(DataType.Time)]
        [Display(Name = "Hora de Término")]
        public TimeSpan? HoraTermino { get; set; }
        
        [Required(ErrorMessage = "O supervisor é obrigatório")]
        [StringLength(100, ErrorMessage = "O nome do supervisor não pode exceder 100 caracteres")]
        public string Supervisor { get; set; }
        
        [Required(ErrorMessage = "O tipo de turno é obrigatório")]
        [Display(Name = "Tipo de Turno")]
        public string TipoTurno { get; set; }
        
        [Display(Name = "Status")]
        public string Status { get; set; }
        
        [Required(ErrorMessage = "A linha de produção é obrigatória")]
        [Display(Name = "Linha de Produção")]
        public int LinhaProducaoId { get; set; }
        
        [DataType(DataType.MultilineText)]
        [StringLength(500, ErrorMessage = "As observações não podem exceder 500 caracteres")]
        [Display(Name = "Observações")]
        public string Observacoes { get; set; }
        
        public List<ItemProducaoViewModel> ItensProduzidos { get; set; }
        
        // Para exibição e seleção
        public string LinhaProducaoNome { get; set; }
        public IEnumerable<LinhaProducao> LinhasDisponiveis { get; set; }
        public string[] TiposTurno { get; set; } = new[] { "Manhã", "Tarde", "Noite" };
        public string[] StatusTurno { get; set; } = new[] { "Em Preparação", "Em Andamento", "Concluído", "Cancelado" };
    }
    
    public class ItemProducaoViewModel
    {
        public int Id { get; set; }
        
        [Required(ErrorMessage = "O modelo é obrigatório")]
        [Display(Name = "Modelo")]
        public int ModeloCalcadoId { get; set; }
        
        [Required(ErrorMessage = "O tamanho é obrigatório")]
        [Range(1, 50, ErrorMessage = "O tamanho deve estar entre 1 e 50")]
        public int Tamanho { get; set; }
        
        [Required(ErrorMessage = "A cor é obrigatória")]
        [StringLength(50, ErrorMessage = "O nome da cor não pode exceder 50 caracteres")]
        public string Cor { get; set; }
        
        [Required(ErrorMessage = "A quantidade planejada é obrigatória")]
        [Range(1, 10000, ErrorMessage = "A quantidade planejada deve estar entre 1 e 10000")]
        [Display(Name = "Qtd. Planejada")]
        public int QuantidadePlanejada { get; set; }
        
        [Range(0, 10000, ErrorMessage = "A quantidade produzida deve estar entre 0 e 10000")]
        [Display(Name = "Qtd. Produzida")]
        public int QuantidadeProduzida { get; set; }
        
        [Range(0, 10000, ErrorMessage = "A quantidade defeituosa deve estar entre 0 e 10000")]
        [Display(Name = "Qtd. Defeituosa")]
        public int QuantidadeDefeituosa { get; set; }
        
        [Display(Name = "Operador")]
        [StringLength(100, ErrorMessage = "O nome do operador não pode exceder 100 caracteres")]
        public string Operador { get; set; }
        
        [Display(Name = "Observações")]
        public string Observacoes { get; set; }
        
        // Para exibição e seleção
        public string ModeloNome { get; set; }
        public string ModeloCodigo { get; set; }
        public IEnumerable<ModeloCalcado> ModelosDisponiveis { get; set; }
        public List<int> TamanhosDisponiveis { get; set; }
        public List<string> CoresDisponiveis { get; set; }
    }
}
```

**ViewModels/Producao/DashboardProducaoViewModel.cs**

csharpresponse-action-icon

```csharp
using System;
using System.Collections.Generic;
using CalcadosOmega.Models.Producao;

namespace CalcadosOmega.ViewModels.Producao
{
    public class DashboardProducaoViewModel
    {
        // Turno atual
        public TurnoProducao TurnoAtual { get; set; }
        
        // Dados de produção do dia
        public int TotalProduzidoHoje { get; set; }
        public int TotalPlanejadoHoje { get; set; }
        public decimal PercentualConcluido { get; set; }
        public int TotalDefeituososHoje { get; set; }
        public decimal TaxaDefeitoHoje { get; set; }
        
        // Dados de eficiência
        public decimal EficienciaAtual { get; set; }
        public decimal EficienciaMedia7Dias { get; set; }
        public decimal EficienciaMedia30Dias { get; set; }
        
        // Estatísticas por período
        public Dictionary<string, int> ProducaoDiaria7Dias { get; set; }
        public Dictionary<string, int> ProducaoSemanal4Semanas { get; set; }
        public Dictionary<string, int> ProducaoMensal6Meses { get; set; }
        
        // Estatísticas por modelo
        public Dictionary<string, int> ProducaoPorModelo { get; set; }
        public Dictionary<string, int> DefeituososPorModelo { get; set; }
        
        // Estatísticas por linha de produção
        public Dictionary<string, int> ProducaoPorLinha { get; set; }
        public Dictionary<string, decimal> EficienciaPorLinha { get; set; }
        
        // Estatísticas de paradas
        public int TotalParadasHoje { get; set; }
        public TimeSpan TempoTotalParadasHoje { get; set; }
        public Dictionary<string, TimeSpan> TempoParadaPorMotivo { get; set; }
        public List<ParadaProducao> UltimasParadas { get; set; }
        
        // Dados de materiais críticos
        public List<MaterialCritico> MateriaisCriticos { get; set; }
        
        // Alertas e notificações
        public List<Alerta> Alertas { get; set; }
    }
    
    public class MaterialCritico
    {
        public int MaterialId { get; set; }
        public string Codigo { get; set; }
        public string Nome { get; set; }
        public int EstoqueAtual { get; set; }
        public int EstoqueMinimo { get; set; }
        public int ConsumoMedio { get; set; }
        public int DiasEstimados { get; set; }
        public bool EmCritico => EstoqueAtual <= EstoqueMinimo;
    }
    
    public class Alerta
    {
        public string Tipo { get; set; } // Crítico, Atenção, Informativo
        public string Mensagem { get; set; }
        public string Destino { get; set; } // URL para ação
        public DateTime Data { get; set; }
    }
}
```

## 5.5 Domain-Driven Design em Models

O Domain-Driven Design (DDD) é uma abordagem para desenvolvimento de software que valoriza o domínio do negócio e sua lógica. Em uma aplicação ASP.NET Core MVC para uma fábrica de calçados, podemos aplicar princípios de DDD para criar modelos mais robustos e expressivos.

### Princípios de DDD no Contexto da Fábrica de Calçados

**1. Entidades com Identidade**

csharpresponse-action-icon

```csharp
public class ModeloCalcado
{
    // Construtor que garante criação válida
    public ModeloCalcado(string codigo, string nome, CategoriaCalcado categoria, string genero)
    {
        if (string.IsNullOrWhiteSpace(codigo))
            throw new ArgumentException("Código do modelo não pode ser vazio");
        
        if (string.IsNullOrWhiteSpace(nome))
            throw new ArgumentException("Nome do modelo não pode ser vazio");
        
        if (categoria == null)
            throw new ArgumentException("Categoria do modelo é obrigatória");
        
        if (string.IsNullOrWhiteSpace(genero))
            throw new ArgumentException("Gênero do modelo não pode ser vazio");
        
        Codigo = codigo;
        Nome = nome;
        Categoria = categoria;
        CategoriaId = categoria.Id;
        Genero = genero;
        DataCriacao = DateTime.Now;
        Ativo = true;
        TamanhosDisponiveis = new List<TamanhoDisponivel>();
        CoresDisponiveis = new List<CorDisponivel>();
        Materiais = new List<MaterialUtilizado>();
        ItensProducao = new List<ItemProducao>();
    }
    
    // Construtor protegido para Entity Framework
    protected ModeloCalcado() { }
    
    public int Id { get; private set; }
    public string Codigo { get; private set; }
    public string Nome { get; private set; }
    public string Descricao { get; private set; }
    public decimal PrecoBase { get; private set; }
    public int CategoriaId { get; private set; }
    public virtual CategoriaCalcado Categoria { get; private set; }
    public string Genero { get; private set; }
    public bool Ativo { get; private set; }
    public DateTime DataCriacao { get; private set; }
    public string ImagemUrl { get; private set; }
    public int TempoProducaoMinutos { get; private set; }
    public string InstrucoesFabricacao { get; private set; }
    public string ReferenciaDesigner { get; private set; }
    
    public virtual IReadOnlyCollection<TamanhoDisponivel> TamanhosDisponiveis => 
        _tamanhosDisponiveis?.AsReadOnly();
    private List<TamanhoDisponivel> _tamanhosDisponiveis;
    
    public virtual IReadOnlyCollection<CorDisponivel> CoresDisponiveis => 
        _coresDisponiveis?.AsReadOnly();
    private List<CorDisponivel> _coresDisponiveis;
    
    public virtual IReadOnlyCollection<MaterialUtilizado> Materiais => 
        _materiais?.AsReadOnly();
    private List<MaterialUtilizado> _materiais;
    
    public virtual IReadOnlyCollection<ItemProducao> ItensProducao => 
        _itensProducao?.AsReadOnly();
    private List<ItemProducao> _itensProducao;
    
    // Métodos que encapsulam regras de negócio
    public void AlterarPrecoBase(decimal novoPreco)
    {
        if (novoPreco <= 0)
            throw new ArgumentException("Preço base deve ser maior que zero");
        
        PrecoBase = novoPreco;
    }
    
    public void AdicionarTamanho(int tamanho, bool gradePadrao = false)
    {
        if (tamanho <= 0 || tamanho > 50)
            throw new ArgumentException("Tamanho deve estar entre 1 e 50");
        
        if (_tamanhosDisponiveis.Any(t => t.Tamanho == tamanho))
            throw new InvalidOperationException($"Tamanho {tamanho} já está cadastrado para este modelo");
        
        _tamanhosDisponiveis.Add(new TamanhoDisponivel(this, tamanho, gradePadrao));
    }
    
    ```csharp
public void AdicionarCor(string nome, string codigoHexadecimal, bool padrao = false)
{
    if (string.IsNullOrWhiteSpace(nome))
        throw new ArgumentException("Nome da cor não pode ser vazio");
    
    if (_coresDisponiveis.Any(c => c.Nome.Equals(nome, StringComparison.OrdinalIgnoreCase)))
        throw new InvalidOperationException($"Cor {nome} já está cadastrada para este modelo");
    
    _coresDisponiveis.Add(new CorDisponivel(this, nome, codigoHexadecimal, padrao));
}

public void AdicionarMaterial(Material material, string parte, decimal quantidade)
{
    if (material == null)
        throw new ArgumentException("Material não pode ser nulo");
    
    if (string.IsNullOrWhiteSpace(parte))
        throw new ArgumentException("Parte do calçado não pode ser vazia");
    
    if (quantidade <= 0)
        throw new ArgumentException("Quantidade deve ser maior que zero");
    
    var materialExistente = _materiais.FirstOrDefault(m => m.MaterialId == material.Id && m.Parte == parte);
    
    if (materialExistente != null)
    {
        materialExistente.AtualizarQuantidade(quantidade);
    }
    else
    {
        _materiais.Add(new MaterialUtilizado(this, material, parte, quantidade));
    }
}

public void Ativar()
{
    Ativo = true;
}

public void Desativar()
{
    Ativo = false;
}

public void AtualizarDadosBasicos(string nome, string descricao, decimal precoBase, int tempoProducao)
{
    if (string.IsNullOrWhiteSpace(nome))
        throw new ArgumentException("Nome do modelo não pode ser vazio");
    
    if (precoBase <= 0)
        throw new ArgumentException("Preço base deve ser maior que zero");
    
    if (tempoProducao <= 0)
        throw new ArgumentException("Tempo de produção deve ser maior que zero");
    
    Nome = nome;
    Descricao = descricao;
    PrecoBase = precoBase;
    TempoProducaoMinutos = tempoProducao;
}

public void DefinirImagem(string imagemUrl)
{
    if (string.IsNullOrWhiteSpace(imagemUrl))
        throw new ArgumentException("URL da imagem não pode ser vazia");
    
    ImagemUrl = imagemUrl;
}

public void AlterarCategoria(CategoriaCalcado novaCategoria)
{
    if (novaCategoria == null)
        throw new ArgumentException("Categoria não pode ser nula");
    
    Categoria = novaCategoria;
    CategoriaId = novaCategoria.Id;
}

public decimal CalcularCustoTotal()
{
    decimal custoMateriais = _materiais.Sum(m => m.CustoTotal);
    return custoMateriais;
}

public decimal CalcularMargemLucro()
{
    decimal custo = CalcularCustoTotal();
    
    if (custo <= 0)
        return 0;
        
    return (PrecoBase - custo) / custo * 100;
}

public bool VerificarDisponibilidadeMateriais(IEstoqueService estoqueService)
{
    if (estoqueService == null)
        throw new ArgumentNullException(nameof(estoqueService));
        
    foreach (var material in Materiais)
    {
        if (!estoqueService.VerificarDisponibilidade(material.MaterialId, material.Quantidade))
            return false;
    }
    
    return true;
}

public override bool Equals(object obj)
{
    var modelo = obj as ModeloCalcado;
    if (modelo == null)
        return false;
        
    return Id == modelo.Id;
}

public override int GetHashCode()
{
    return Id.GetHashCode();
}
}
```

**2. Agregados e Raízes**

Os agregados são conjuntos de objetos relacionados que tratamos como uma unidade para alterações de dados. No contexto da fábrica, temos agregados como:

csharpresponse-action-icon

```csharp
// TurnoProducao é a raiz do agregado que inclui ItemProducao e ParadaProducao
public class TurnoProducao
{
    // Construtor que garante criação válida
    public TurnoProducao(DateTime data, TimeSpan horaInicio, string supervisor, string tipoTurno, LinhaProducao linhaProducao)
    {
        if (data.Date < DateTime.Today)
            throw new ArgumentException("Data do turno não pode ser no passado");
            
        if (string.IsNullOrWhiteSpace(supervisor))
            throw new ArgumentException("Supervisor não pode ser vazio");
            
        if (string.IsNullOrWhiteSpace(tipoTurno))
            throw new ArgumentException("Tipo de turno não pode ser vazio");
            
        if (linhaProducao == null)
            throw new ArgumentException("Linha de produção é obrigatória");
            
        Data = data;
        HoraInicio = horaInicio;
        Supervisor = supervisor;
        TipoTurno = tipoTurno;
        LinhaProducao = linhaProducao;
        LinhaProducaoId = linhaProducao.Id;
        Status = "Em Preparação";
        DataCriacao = DateTime.Now;
        
        _itensProduzidos = new List<ItemProducao>();
        _paradas = new List<ParadaProducao>();
        _movimentacoesMateriais = new List<MovimentacaoEstoque>();
    }
    
    // Construtor protegido para Entity Framework
    protected TurnoProducao() { }
    
    public int Id { get; private set; }
    public DateTime Data { get; private set; }
    public TimeSpan HoraInicio { get; private set; }
    public TimeSpan? HoraTermino { get; private set; }
    public string Supervisor { get; private set; }
    public string TipoTurno { get; private set; }
    public string Status { get; private set; }
    public int LinhaProducaoId { get; private set; }
    public virtual LinhaProducao LinhaProducao { get; private set; }
    public DateTime DataCriacao { get; private set; }
    public DateTime? DataEncerramento { get; private set; }
    public string Observacoes { get; private set; }
    public decimal? EficienciaCalculada { get; private set; }
    
    private List<ItemProducao> _itensProduzidos;
    public virtual IReadOnlyCollection<ItemProducao> ItensProduzidos => 
        _itensProduzidos?.AsReadOnly();
        
    private List<ParadaProducao> _paradas;
    public virtual IReadOnlyCollection<ParadaProducao> Paradas => 
        _paradas?.AsReadOnly();
        
    private List<MovimentacaoEstoque> _movimentacoesMateriais;
    public virtual IReadOnlyCollection<MovimentacaoEstoque> MovimentacoesMateriais => 
        _movimentacoesMateriais?.AsReadOnly();
    
    // Métodos de negócio
    public void IniciarProducao()
    {
        if (Status != "Em Preparação")
            throw new InvalidOperationException("Só é possível iniciar um turno que esteja em preparação");
            
        if (!_itensProduzidos.Any())
            throw new InvalidOperationException("Não é possível iniciar um turno sem itens de produção");
            
        Status = "Em Andamento";
    }
    
    public void EncerrarProducao(TimeSpan horaTermino, string observacoes = null)
    {
        if (Status != "Em Andamento")
            throw new InvalidOperationException("Só é possível encerrar um turno em andamento");
            
        if (horaTermino <= HoraInicio)
            throw new ArgumentException("Hora de término deve ser posterior à hora de início");
            
        HoraTermino = horaTermino;
        Status = "Concluído";
        DataEncerramento = DateTime.Now;
        Observacoes = observacoes;
        
        // Calcula eficiência
        CalcularEficiencia();
    }
    
    public void CancelarProducao(string motivo)
    {
        if (Status == "Concluído" || Status == "Cancelado")
            throw new InvalidOperationException("Não é possível cancelar um turno já concluído ou cancelado");
            
        Status = "Cancelado";
        DataEncerramento = DateTime.Now;
        Observacoes = motivo;
    }
    
    public ItemProducao AdicionarItemProducao(ModeloCalcado modelo, int tamanho, string cor, int quantidadePlanejada)
    {
        if (Status != "Em Preparação")
            throw new InvalidOperationException("Só é possível adicionar itens de produção a um turno em preparação");
            
        if (modelo == null)
            throw new ArgumentException("Modelo não pode ser nulo");
            
        if (tamanho <= 0)
            throw new ArgumentException("Tamanho deve ser maior que zero");
            
        if (string.IsNullOrWhiteSpace(cor))
            throw new ArgumentException("Cor não pode ser vazia");
            
        if (quantidadePlanejada <= 0)
            throw new ArgumentException("Quantidade planejada deve ser maior que zero");
            
        var item = new ItemProducao(this, modelo, tamanho, cor, quantidadePlanejada);
        _itensProduzidos.Add(item);
        
        return item;
    }
    
    public void RemoverItemProducao(int itemId)
    {
        if (Status != "Em Preparação")
            throw new InvalidOperationException("Só é possível remover itens de produção de um turno em preparação");
            
        var item = _itensProduzidos.FirstOrDefault(i => i.Id == itemId);
        
        if (item == null)
            throw new ArgumentException("Item de produção não encontrado");
            
        _itensProduzidos.Remove(item);
    }
    
    public void RegistrarProducao(int itemId, int quantidadeProduzida, int quantidadeDefeituosa, string operador)
    {
        if (Status != "Em Andamento")
            throw new InvalidOperationException("Só é possível registrar produção em um turno em andamento");
            
        var item = _itensProduzidos.FirstOrDefault(i => i.Id == itemId);
        
        if (item == null)
            throw new ArgumentException("Item de produção não encontrado");
            
        item.RegistrarProducao(quantidadeProduzida, quantidadeDefeituosa, operador);
    }
    
    public ParadaProducao RegistrarParada(TimeSpan horaInicio, string motivo, string descricao)
    {
        if (Status != "Em Andamento")
            throw new InvalidOperationException("Só é possível registrar paradas em um turno em andamento");
            
        if (horaInicio < HoraInicio)
            throw new ArgumentException("Hora de início da parada não pode ser anterior à hora de início do turno");
            
        if (HoraTermino.HasValue && horaInicio > HoraTermino.Value)
            throw new ArgumentException("Hora de início da parada não pode ser posterior à hora de término do turno");
            
        if (string.IsNullOrWhiteSpace(motivo))
            throw new ArgumentException("Motivo da parada não pode ser vazio");
            
        var parada = new ParadaProducao(this, horaInicio, motivo, descricao);
        _paradas.Add(parada);
        
        return parada;
    }
    
    public void FinalizarParada(int paradaId, TimeSpan horaFim, string responsavelSolucao, string acaoCorretiva, bool acaoPreventiva)
    {
        if (Status != "Em Andamento" && Status != "Concluído")
            throw new InvalidOperationException("Só é possível finalizar paradas em um turno em andamento ou concluído");
            
        var parada = _paradas.FirstOrDefault(p => p.Id == paradaId);
        
        if (parada == null)
            throw new ArgumentException("Parada não encontrada");
            
        parada.Finalizar(horaFim, responsavelSolucao, acaoCorretiva, acaoPreventiva);
    }
    
    public void RegistrarMovimentacaoMaterial(Material material, decimal quantidade, string tipo, string documento, string responsavel)
    {
        if (material == null)
            throw new ArgumentException("Material não pode ser nulo");
            
        if (quantidade <= 0)
            throw new ArgumentException("Quantidade deve ser maior que zero");
            
        if (string.IsNullOrWhiteSpace(tipo))
            throw new ArgumentException("Tipo de movimentação não pode ser vazio");
            
        if (string.IsNullOrWhiteSpace(documento))
            throw new ArgumentException("Documento de referência não pode ser vazio");
            
        if (string.IsNullOrWhiteSpace(responsavel))
            throw new ArgumentException("Responsável não pode ser vazio");
            
        var movimentacao = new MovimentacaoEstoque(material, DateTime.Now, tipo, quantidade, documento, responsavel, this);
        _movimentacoesMateriais.Add(movimentacao);
    }
    
    private void CalcularEficiencia()
    {
        if (!HoraTermino.HasValue)
            return;
            
        TimeSpan tempoEfetivo = TempoEfetivo;
        
        if (tempoEfetivo == TimeSpan.Zero)
            return;
            
        int totalProduzido = TotalProduzido;
        int capacidadeEstimada = (int)(LinhaProducao.CapacidadePorHora * tempoEfetivo.TotalHours);
        
        if (capacidadeEstimada > 0)
        {
            EficienciaCalculada = (decimal)totalProduzido / capacidadeEstimada * 100;
        }
    }
}
```

**3. Serviços de Domínio**

Os serviços de domínio encapsulam operações de negócio que não pertencem naturalmente a nenhuma entidade:

csharpresponse-action-icon

```csharp
public interface IProducaoService
{
    // Operações específicas do domínio de produção
    EficienciaProducao CalcularEficienciaTurno(int turnoId);
    List<ModeloCalcado> ObterModelosMaisProduzidos(DateTime inicio, DateTime fim, int quantidade);
    void ReservarMateriaisParaTurno(TurnoProducao turno);
    RelatorioProducao GerarRelatorioPorPeriodo(DateTime dataInicio, DateTime dataFim);
    List<ParadaAnalise> AnalisarParadasRecorrentes(DateTime inicio, DateTime fim);
    bool VerificarDisponibilidadeParaProducao(ModeloCalcado modelo, int quantidade);
}

public class ProducaoService : IProducaoService
{
    private readonly ITurnoProducaoRepository _turnoRepository;
    private readonly IModeloCalcadoRepository _modeloRepository;
    private readonly IMaterialRepository _materialRepository;
    private readonly IEstoqueService _estoqueService;
    
    public ProducaoService(
        ITurnoProducaoRepository turnoRepository,
        IModeloCalcadoRepository modeloRepository,
        IMaterialRepository materialRepository,
        IEstoqueService estoqueService)
    {
        _turnoRepository = turnoRepository;
        _modeloRepository = modeloRepository;
        _materialRepository = materialRepository;
        _estoqueService = estoqueService;
    }
    
    public EficienciaProducao CalcularEficienciaTurno(int turnoId)
    {
        var turno = _turnoRepository.GetById(turnoId);
        
        if (turno == null)
            throw new ArgumentException("Turno não encontrado");
            
        if (turno.Status != "Concluído")
            throw new InvalidOperationException("Só é possível calcular eficiência de turnos concluídos");
        
        // Lógica de cálculo de eficiência...
        var eficiencia = new EficienciaProducao
        {
            TurnoId = turnoId,
            TotalProduzido = turno.TotalProduzido,
            TotalPlanejado = turno.ItensProduzidos.Sum(i => i.QuantidadePlanejada),
            TempoEfetivo = turno.TempoEfetivo,
            TempoParadas = turno.TempoParadas,
            EficienciaGeral = turno.EficienciaCalculada ?? 0
        };
        
        return eficiencia;
    }
    
    public List<ModeloCalcado> ObterModelosMaisProduzidos(DateTime inicio, DateTime fim, int quantidade)
    {
        // Lógica para obter modelos mais produzidos no período...
        var turnosPeriodo = _turnoRepository.GetByPeriod(inicio, fim);
        
        var modelosProduzidos = turnosPeriodo
            .SelectMany(t => t.ItensProduzidos)
            .GroupBy(i => i.ModeloCalcadoId)
            .Select(g => new 
            {
                ModeloId = g.Key,
                QuantidadeProduzida = g.Sum(i => i.QuantidadeProduzida)
            })
            .OrderByDescending(x => x.QuantidadeProduzida)
            .Take(quantidade)
            .ToList();
        
        var modelosIds = modelosProduzidos.Select(m => m.ModeloId).ToList();
        return _modeloRepository.GetByIds(modelosIds);
    }
    
    // Implementação dos outros métodos...
}
```

**4. Objetos de Valor**

Objetos de valor são objetos imutáveis que representam conceitos do domínio sem identidade própria:

csharpresponse-action-icon

```csharp
public class EnderecoFornecedor
{
    // Construtor que valida todos os parâmetros
    public EnderecoFornecedor(
        string logradouro, 
        string numero, 
        string complemento, 
        string bairro, 
        string cidade, 
        string estado, 
        string cep)
    {
        if (string.IsNullOrWhiteSpace(logradouro))
            throw new ArgumentException("Logradouro não pode ser vazio");
            
        if (string.IsNullOrWhiteSpace(numero))
            throw new ArgumentException("Número não pode ser vazio");
            
        if (string.IsNullOrWhiteSpace(bairro))
            throw new ArgumentException("Bairro não pode ser vazio");
            
        if (string.IsNullOrWhiteSpace(cidade))
            throw new ArgumentException("Cidade não pode ser vazia");
            
        if (string.IsNullOrWhiteSpace(estado))
            throw new ArgumentException("Estado não pode ser vazio");
            
        if (string.IsNullOrWhiteSpace(cep))
            throw new ArgumentException("CEP não pode ser vazio");
        
        Logradouro = logradouro;
        Numero = numero;
        Complemento = complemento;
        Bairro = bairro;
        Cidade = cidade;
        Estado = estado;
        CEP = cep;
    }
    
    // Propriedades somente leitura garantem imutabilidade
    public string Logradouro { get; }
    public string Numero { get; }
    public string Complemento { get; }
    public string Bairro { get; }
    public string Cidade { get; }
    public string Estado { get; }
    public string CEP { get; }
    
    // Formatação de endereço completo
    public string EnderecoCompleto => 
        $"{Logradouro}, {Numero}{(!string.IsNullOrEmpty(Complemento) ? $" - {Complemento}" : "")}, {Bairro}, {Cidade}/{Estado}, CEP {CEP}";
        
    // Sobrescrita de Equals e GetHashCode para comparação baseada em valor
    public override bool Equals(object obj)
    {
        var outro = obj as EnderecoFornecedor;
        if (outro == null)
            return false;
            
        return Log
```